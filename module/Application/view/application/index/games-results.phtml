<?php
$this->headTitle('Games results');

$this->mainMenu()->setActiveItemId('schedule');

$this->pageBreadcrumbs()->setItems([
    'Home' => $this->url('home'),
    'Game results' => $this->url('games-results'),
]);
?>

<div class="row">
    <h1 class="col mt-3 mb-3">Wedstrijd resultaten</h1>
</div>
<div class="row">
    <div class="col">
        <table id="resultsTable" class="table table-sm table-bordered table-hover">
            <thead class="thead-dark">
                <tr>
                    <th scope="col" class="text-center"><?php echo $this->translator()->translate('season.game.home.player.title'); ?></th>
                    <th scope="col" colspan="3" class="text-center"><i class="far fa-futbol"></i></th>
                    <th scope="col" class="text-center" scope="col"><?php echo $this->translator()->translate('season.game.away.player.title'); ?></th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($season->getGames() as $index => $game) { ?>
                    <tr data-game-id="<?php echo $game->getId(); ?>" class="clickableRowResult <?php echo ($index % 2 == 0 ? '' : 'bg-dark text-white'); ?>">
                        <td class="text-center" scope="row" class="text-center"><?php echo $game->getHomePlayer()->getFullName(); ?></td>
                        <td class="text-center"><?php echo (is_object($game->getHomeGameResult()) ? $game->getHomeGameResult()->getGoalsH() : ''); ?></td>
                        <td class="text-center"><b>-</b></td>
                        <td class="text-center"><?php echo (is_object($game->getAwayGameResult()) ? $game->getAwayGameResult()->getGoalsA() : ''); ?></td>
                        <td class="text-center"><?php echo $game->getAwayPlayer()->getFullName(); ?></td>
                    </tr>
                <?php } ?>
            </tbody>
        </table>
    </div>
</div>

<script>
//Get game data for result modal
    $("#resultsTable tbody tr.clickableRowResult").on("click", function () {
        var gameId = $(this).data('game-id');
        $.ajax({
            type: 'POST',
            data: {
                gameId: gameId
            },
            url: "/game-ajax/getGame",
            async: true,
            success: function (data) {
                if (data.success === true) {
                    //Extract game data
                    $.each(data.result, function (index, value) {
                        $.each(data.result[index], function (index, value) {
                            if(index == 'possessionH' || index == 'possessionA') {
                                $('#' + index).attr('style', 'width:'+value+'%;');
                                $('#' + index).attr('aria-valuenow', value);
                                $('#' + index).html(value + '%');
                            } else {
                                $('#' + index).html(value);
                            }
                            
                        });
                    });
                    $('#statsModal').modal('toggle')

                } else {
                    alert(data.errorMessage);
                }

            }
        });
    });

</script>


<!-- Modal -->
<div class="modal fade bd-example-modal-lg" id="statsModal" tabindex="-1" role="dialog" aria-labelledby="statsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-center" id="statsModalLabel"><?php echo $this->translator()->translate('game.stats.title'); ?></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row mb-3 pb-2 pt-2 justify-content-md-center">
                    <div class="col"><h4 id="homePlayer"></h4></div>
                    <div class="col-md-auto text-center"><h4><i class="far fa-futbol"></i></h4></div>
                    <div class="col text-right"><h4 id="awayPlayer"></h4></div>
                </div>
                <div class="row mb-3 pb-2 pt-2 justify-content-md-center">
                    <div class="col-md-2 text-right" id="goalsH"></div>
                    <div class="col text-center"><h4 id="playDate"></h4></div>
                    <div class="col-md-2" id="goalsA"></div>
                </div>

                <div class="row mb-1">
                    <div class="col-md-2 text-right" id="totalShotsH"></div>
                    <div class="col text-center"><b><?php echo $this->translator()->translate('game.total.shots') ?></b></div>
                    <div class="col-md-2" id="totalShotsA"></div>
                </div>

                <div class="row mb-1">
                    <div class="col-md-2 text-right" id="shotOnTargetH"></div>
                    <div class="col text-center"><b><?php echo $this->translator()->translate('game.shots.target') ?></b></div>
                    <div class="col-md-2" id="shotOnTargetA"></div>
                </div>

                <div class="row mb-1">
                    <div class="col-md-2"></div>
                    <div class="col text-center"><b><?php echo $this->translator()->translate('game.possesion') ?></b></div>
                    <div class="col-md-2"></div>
                </div>

                <div class="row mb-1">
                    <div class="col-md-1"></div>
                    <div class="col">
                        <div class="progress">
                            <div id="possessionH" class="progress-bar bg-info" role="progressbar" style="" aria-valuenow="" aria-valuemin="0" aria-valuemax="100"></div>
                            <div id="possessionA" class="progress-bar bg-warning" role="progressbar" style="" aria-valuenow="" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </div>



                <div class="row mb-1">
                    <div class="col-md-2 text-right" id="tacklesH"></div>
                    <div class="col text-center"><b><?php echo $this->translator()->translate('game.tackles') ?></b></div>
                    <div class="col-md-2" id="tacklesA"></div>
                </div>

                <div class="row mb-1">
                    <div class="col-md-2 text-right" id="foulsH"></div>
                    <div class="col text-center"><b><?php echo $this->translator()->translate('game.fouls') ?></b></div>
                    <div class="col-md-2" id="foulsA"></div>
                </div>

                <div class="row mb-1">
                    <div class="col-md-2 text-right" id="yellowCardsH"></div>
                    <div class="col text-center"><b><?php echo $this->translator()->translate('game.yellow.cards') ?></b></div>
                    <div class="col-md-2" id="yellowCardsA"></div>
                </div>

                <div class="row mb-1">
                    <div class="col-md-2 text-right" id="redCardsH"></div>
                    <div class="col text-center"><b><?php echo $this->translator()->translate('game.red.cards') ?></b></div>
                    <div class="col-md-2" id="redCardsA"></div>
                </div>

                <div class="row mb-1">
                    <div class="col-md-2 text-right" id="injuriesH"></div>
                    <div class="col text-center"><b><?php echo $this->translator()->translate('game.injuries') ?></b></div>
                    <div class="col-md-2" id="injuriesA"></div>
                </div>

                <div class="row mb-1">
                    <div class="col-md-2 text-right" id="offsideH"></div>
                    <div class="col text-center"><b><?php echo $this->translator()->translate('game.offside') ?></b></div>
                    <div class="col-md-2" id="offsideA"></div>
                </div>

                <div class="row mb-1">
                    <div class="col-md-2 text-right" id="cornersH"></div>
                    <div class="col text-center"><b><?php echo $this->translator()->translate('game.corners') ?></b></div>
                    <div class="col-md-2" id="cornersA"></div>
                </div>

                <div class="row mb-1">
                    <div class="col-md-2 text-right" id="shotAccuracyH"></div>
                    <div class="col text-center"><b><?php echo $this->translator()->translate('game.shot.accuracy') ?></b></div>
                    <div class="col-md-2" id="shotAccuracyA"></div>
                </div>

                <div class="row mb-1">
                    <div class="col-md-2 text-right" id="passAccuracyH"></div>
                    <div class="col text-center"><b><?php echo $this->translator()->translate('game.pass.accuracy') ?></b></div>
                    <div class="col-md-2" id="passAccuracyA"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-dark" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>